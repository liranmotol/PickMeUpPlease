<html>
<head>
    <script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="http://www.jsoneditoronline.org/asset/jsoneditor/jsoneditor.min.js"></script>
    <link rel="stylesheet" type="text/css" href="http://www.jsoneditoronline.org/asset/jsoneditor/jsoneditor.min.css">
    

</head>
<body>
    <style type="text/css">
    /*body {
            font: 11pt arial;
        }*/

    #jsoneditor {
        width: 500px;
    }
</style>

    Students Controller:<br />
    <button onclick="GetUpdatedStudents()" >GetUpdatedStudents</button><br />
    <button onclick="PickedUp()" >PickedUp</button><br />
    <button onclick="CheckedIn()" >CheckedIn</button><br />
    <br /><br />
    Branches Controller:<br />
    <button onclick="GetBranches()" >GetBranches</button><br />

    <br /><br />
    Login Controller:
    <br />
    <button onclick="LoginRegister()">Register</button><br />
    <button onclick="GetToken()">GetToken</button><br />

    <br />
	<br /><br />
    Test Method:
    <br />
    <button onclick="TestMethod()">Test Method</button><br />
  <button onclick="TestMethod2()">Test Method2</button><br />


    <div id="jsoneditor"></div>



    <script type="text/javascript">
		var token = "";
        var ServerUrl = "http://localhost:47588/"; //"http://pickmeplease.azurewebsites.net/";//
        function SendRequest(method, json) {
            var jsonAsString = JSON.stringify(json);

           // var LastSyncTime = (new Date()).toISOString();
            //var Request =
              //  {
               //     LastSyncTime: LastSyncTime,
                //    Token: token,
                //};
            //jsonAsString= JSON.stringify(Request);
			


            $.ajax({
                type: "POST",
                url: ServerUrl + method,
                data: jsonAsString,
				headers: {'Authorization':'Bearer '+token},
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    displayJson(data);

                },
                error: function (data) {
                    console.log(data);
                    displayJson(data);

                }
            });

        }
        //students
        function GetUpdatedStudents()
        {
            var request =
                {
                    BranchId: 1,
                    LastSyncTime: (new Date()).toISOString(),
                    Token: token
                };
            SendRequest("Students/Update", request);
        }

        function CheckedIn()
        {
            var request =
                {
                    BranchId: 1,
                    StudentId:"3",
                    Token: token
                };
            SendRequest("Students/CheckedIn", request);
        }

        function PickedUp() {
            var request =
                {
                    BranchId: 1,
                    StudentId: "3",
                    Token: token,
                    PickerName :"Erans dad"
                };
            SendRequest("Students/PickedUp", request);
        }

        //branches
        function GetBranches() {
            var request =
                {
                    LastSyncTime: (new Date()).toISOString(),
                    Token: token
                };
            SendRequest("Branches/Get", request);
        }

        //Auth
        function LoginRegister()
        {
            var request = {
                "userName": "liran1",
                "password": "liran1",
                "confirmPassword": "liran1"
            }
            SendRequest("account/register", request);

        }
        function GetToken() {
            var request = {
                grant_type: "password",
                username: "liran1",
                password: "liran1"
            }
            var jsonAsString = JSON.stringify(request);
			jsonAsString="grant_type=password&username=liran1&password=liran1";
			//var urlEnc = encodeURIComponent(temp);
            $.ajax({
                type: "POST",
                url: ServerUrl + "account/token",
                data: jsonAsString,
				Accept: "application/json",
                contentType: "application/x-www-form-urlencoded",
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    displayJson(data);
					token = data.access_token;
                },
                error: function (data) {
                    console.log(data);
                    displayJson(data);

                }
            });


        }
		
		function TestMethod()
		{
			SendRequest("main/testMethod",null);
		}
		function TestMethod2()
		{
			SendRequest("main/testMethod2",null);
		}


    </script>
    <script type="text/javascript">
        function displayJson(json) {
            var container = document.getElementById('jsoneditor');

            var options = {
                mode: 'view'
            };

            container.innerHTML = "";
            var editor = new JSONEditor(container, options, json);
        }


    displayJson();
    </script>

</body>
</html>
<!-- We are using Hadarâ€™s account: hadar-shchori, htsol123 -->
